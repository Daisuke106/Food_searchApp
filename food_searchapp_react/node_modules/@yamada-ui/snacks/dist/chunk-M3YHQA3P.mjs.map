{"version":3,"sources":["../src/snacks.tsx"],"sourcesContent":["import type { CSSUIObject, ThemeConfig } from \"@yamada-ui/core\"\nimport { ui, forwardRef, useTheme } from \"@yamada-ui/core\"\nimport type { MotionProps, MotionVariants } from \"@yamada-ui/motion\"\nimport { AnimatePresence, Motion, useIsPresent } from \"@yamada-ui/motion\"\nimport { useTimeout } from \"@yamada-ui/use-timeout\"\nimport { useToken } from \"@yamada-ui/use-token\"\nimport { useValue } from \"@yamada-ui/use-value\"\nimport { calc, cx, noop, runIfFunc, useUpdateEffect } from \"@yamada-ui/utils\"\nimport type { RefObject } from \"react\"\nimport { createRef, memo, useEffect, useMemo, useRef, useState } from \"react\"\nimport type { Snack, UseSnacksOptions, UseSnacksReturn } from \"./use-snacks\"\n\nconst defaultContainerVariants: MotionVariants = {\n  initial: { padding: 0 },\n  animate: ({ gutter }) => ({\n    padding: `${gutter[0]} 0 ${gutter[1]}`,\n    transition: { duration: 0.4 },\n  }),\n  exit: { padding: 0 },\n}\n\nconst defaultListVariants: MotionVariants = {\n  initial: { opacity: 1, height: 0 },\n  animate: ({ height }) => ({\n    opacity: 1,\n    height,\n    transition: { duration: 0.4 },\n  }),\n  exit: { opacity: 0, height: 0 },\n}\n\ntype SnacksOptions = {\n  snacks: UseSnacksReturn[\"snacks\"]\n  /**\n   * The variants of the snacks container.\n   * Check the docs to see the variants of possible modifiers you can pass.\n   *\n   * @see Docs https://www.framer.com/motion/animation/#variants\n   */\n  containerVariants?: MotionVariants\n  /**\n   * The variants of the snacks list.\n   * Check the docs to see the variants of possible modifiers you can pass.\n   *\n   * @see Docs https://www.framer.com/motion/animation/#variants\n   */\n  listVariants?: MotionVariants\n  /**\n   * Props for the snacks list element.\n   */\n  listProps?: MotionProps\n}\n\nexport type SnacksProps = Omit<MotionProps<\"div\">, \"direction\"> &\n  SnacksOptions &\n  Pick<UseSnacksOptions, \"direction\" | \"startIndex\"> &\n  Pick<Required<ThemeConfig>[\"snacks\"], \"variants\" | \"gutter\" | \"negateMargin\">\n\nexport const Snacks = forwardRef<SnacksProps, \"div\">(\n  (\n    {\n      className,\n      snacks,\n      containerVariants = defaultContainerVariants,\n      listVariants = defaultListVariants,\n      listProps,\n      ...props\n    },\n    ref,\n  ) => {\n    const { items, ...computedSnacks } = snacks\n    const count = items.length\n\n    const refMap = useRef<Map<number, RefObject<HTMLLIElement>>>(new Map())\n    const [height, setHeight] = useState<number>(0)\n    const [isExist, setIsExist] = useState<boolean>(!!count)\n    const { theme } = useTheme()\n    const {\n      variants,\n      direction = \"top\",\n      startIndex = 0,\n      gutter = [0, 0],\n      gap = \"fallback(4, 1rem)\",\n      negateMargin = true,\n      ...rest\n    } = useMemo(\n      () => ({ ...computedSnacks, ...theme.__config.snacks, ...props }),\n      [computedSnacks, theme, props],\n    )\n    const top = useToken<string | number>(\"spaces\", useValue(gutter[0])) ?? 0\n    const bottom = useToken<string | number>(\"spaces\", useValue(gutter[1])) ?? 0\n    const negatedTop = calc(top).negate().toString()\n    const negatedBottom = calc(bottom).negate().toString()\n    const isShow = !!count || isExist\n\n    const css: CSSUIObject = {\n      w: \"100%\",\n      var: [{ __prefix: \"ui\", name: \"space\", token: \"spaces\", value: gap }],\n      margin: negateMargin ? `${negatedTop} 0 ${negatedBottom}` : undefined,\n    }\n\n    useEffect(() => {\n      let height = 0\n\n      if (!count) return\n\n      const refs = [...refMap.current.values()].slice(0, count)\n\n      for (const ref of refs) {\n        if (!ref.current) continue\n\n        let { offsetHeight, offsetTop } = ref.current\n\n        offsetHeight += offsetTop\n\n        if (offsetHeight > height) height = offsetHeight\n      }\n\n      setHeight(height)\n    }, [count, direction])\n\n    useUpdateEffect(() => {\n      if (!!count) setIsExist(true)\n    }, [count])\n\n    return (\n      <AnimatePresence initial={false}>\n        {isShow ? (\n          <Motion\n            ref={ref}\n            className={cx(\"ui-snacks\", className)}\n            __css={css}\n            variants={containerVariants}\n            custom={{ gutter: [top, bottom] }}\n            initial=\"initial\"\n            animate=\"animate\"\n            exit=\"exit\"\n            {...rest}\n          >\n            <Motion\n              as=\"ul\"\n              className=\"ui-snacks__list\"\n              variants={listVariants}\n              custom={{ height }}\n              initial=\"initial\"\n              animate=\"animate\"\n              exit=\"exit\"\n              __css={{\n                position: \"relative\",\n                w: \"100%\",\n              }}\n              {...listProps}\n            >\n              <AnimatePresence\n                onExitComplete={() => {\n                  if (!count) setIsExist(false)\n                }}\n              >\n                {items.map((props, index) => {\n                  const ref = createRef<HTMLLIElement>()\n\n                  refMap.current.set(index, ref)\n\n                  return (\n                    <SnackComponent\n                      key={props.id}\n                      ref={ref}\n                      index={index}\n                      lastIndex={count - index - 1}\n                      startIndex={startIndex}\n                      variants={variants}\n                      direction={direction}\n                      {...props}\n                    />\n                  )\n                })}\n              </AnimatePresence>\n            </Motion>\n          </Motion>\n        ) : null}\n      </AnimatePresence>\n    )\n  },\n)\n\nconst defaultItemVariants: MotionVariants = {\n  initial: ({ index, direction }) => ({\n    opacity: 0,\n    ...(index ? { y: (direction === \"top\" ? -1 : 1) * 16 } : {}),\n  }),\n  animate: ({ index }) => ({\n    opacity: 1,\n    y: 0,\n    transition: {\n      delay: !index ? 0.4 : 0,\n      duration: 0.4,\n      ease: [0.4, 0, 0.2, 1],\n    },\n  }),\n  exit: {\n    opacity: 0,\n    transition: {\n      duration: 0.2,\n      ease: [0.4, 0, 1, 1],\n    },\n  },\n}\n\ntype SnackComponentOptions = {\n  index: number\n  lastIndex: number\n}\n\ntype SnackComponentProps = Snack &\n  Pick<SnacksProps, \"variants\"> &\n  Pick<Required<SnacksProps>, \"direction\" | \"startIndex\"> &\n  SnackComponentOptions\n\nconst SnackComponent = memo(\n  forwardRef<SnackComponentProps, \"li\">(\n    (\n      {\n        index,\n        lastIndex,\n        startIndex,\n        direction,\n        variants = defaultItemVariants,\n        duration = null,\n        message,\n        onClose: onCloseProp,\n        onCloseComplete,\n        style,\n      },\n      ref,\n    ) => {\n      const [delay, setDelay] = useState(duration)\n      const isPresent = useIsPresent()\n\n      const onClose = isPresent ? onCloseProp : noop\n      const onMouseEnter = () => setDelay(null)\n      const onMouseLeave = () => setDelay(duration)\n\n      const zIndex = startIndex + index\n      const space = `calc(var(--ui-space) * ${\n        direction === \"top\" ? lastIndex : index\n      })`\n\n      const css: CSSUIObject = {\n        position: \"absolute\",\n        top: space,\n        left: 0,\n        right: 0,\n        zIndex,\n        w: \"100%\",\n        maxW: \"100%\",\n        ...style,\n      }\n\n      useUpdateEffect(() => {\n        if (!isPresent) onCloseComplete?.()\n      }, [isPresent])\n\n      useUpdateEffect(() => {\n        setDelay(duration)\n      }, [duration])\n\n      useTimeout(onClose, delay)\n\n      return (\n        <ui.li ref={ref} className=\"ui-snacks__item\" __css={css}>\n          <Motion\n            className=\"ui-snacks__item-inner\"\n            layout\n            variants={variants}\n            custom={{ index, lastIndex, direction }}\n            initial=\"initial\"\n            animate=\"animate\"\n            exit=\"exit\"\n            onHoverStart={onMouseEnter}\n            onHoverEnd={onMouseLeave}\n          >\n            {runIfFunc(message, { index, onClose })}\n          </Motion>\n        </ui.li>\n      )\n    },\n  ),\n)\n\nSnackComponent.displayName = \"SnackComponent\"\n"],"mappings":"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","names":["height","ref","props"]}