{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { useSafeLayoutEffect, isRefObject, isArray } from \"@yamada-ui/utils\"\nimport { useState } from \"react\"\n\ntype Size = {\n  width: number\n  height: number\n}\n\nexport const trackElementSize = (\n  el: HTMLElement | null,\n  cb: (size: Size | undefined) => void,\n) => {\n  if (!el) {\n    cb(undefined)\n\n    return\n  }\n\n  cb({ width: el.offsetWidth, height: el.offsetHeight })\n\n  const win = el.ownerDocument.defaultView ?? window\n\n  const observer = new win.ResizeObserver((entries) => {\n    if (!isArray(entries) || !entries.length) return\n\n    const [entry] = entries\n    let width: number\n    let height: number\n\n    if (\"borderBoxSize\" in entry) {\n      const borderSizeEntry = entry.borderBoxSize\n      const borderSize = isArray(borderSizeEntry)\n        ? borderSizeEntry[0]\n        : borderSizeEntry\n\n      width = borderSize.inlineSize\n      height = borderSize.blockSize\n    } else {\n      width = el.offsetWidth\n      height = el.offsetHeight\n    }\n\n    cb({ width, height })\n  })\n\n  observer.observe(el, { box: \"border-box\" })\n\n  return () => observer.unobserve(el)\n}\n\nconst trackMutation = (el: HTMLElement | null, cb: () => void) => {\n  if (!el || !el.parentElement) return\n\n  const win = el.ownerDocument?.defaultView ?? window\n\n  const observer = new win.MutationObserver(() => {\n    cb()\n  })\n\n  observer.observe(el.parentElement, { childList: true })\n\n  return () => {\n    observer.disconnect()\n  }\n}\n\nexport const useSizes = <T extends HTMLElement | null>({\n  getNodes,\n  observeMutation = true,\n}: {\n  getNodes: () => T[]\n  observeMutation?: boolean\n}) => {\n  const [sizes, setSizes] = useState<Size[]>([])\n  const [count, setCount] = useState(0)\n\n  useSafeLayoutEffect(() => {\n    const elements = getNodes()\n\n    const cleanups = elements.map((element, index) =>\n      trackElementSize(element, (size) => {\n        setSizes((sizes) => {\n          return [\n            ...sizes.slice(0, index),\n            size,\n            ...sizes.slice(index + 1),\n          ] as Size[]\n        })\n      }),\n    )\n\n    if (observeMutation) {\n      const firstNode = elements[0]\n\n      cleanups.push(\n        trackMutation(firstNode, () => {\n          setCount((count) => count + 1)\n        }),\n      )\n    }\n\n    return () => {\n      cleanups.forEach((cleanup) => {\n        cleanup?.()\n      })\n    }\n  }, [count])\n\n  return sizes as (Size | undefined)[]\n}\n\nexport const useSize = <T extends HTMLElement | null>(\n  refOrEl: T | React.RefObject<T>,\n) => {\n  const [size] = useSizes({\n    observeMutation: false,\n\n    getNodes: () => {\n      const node = isRefObject(refOrEl) ? refOrEl.current : refOrEl\n\n      return [node]\n    },\n  })\n\n  return size as Size | undefined\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA0D;AAC1D,mBAAyB;AAOlB,IAAM,mBAAmB,CAC9B,IACA,OACG;AAXL;AAYE,MAAI,CAAC,IAAI;AACP,OAAG,MAAS;AAEZ;AAAA,EACF;AAEA,KAAG,EAAE,OAAO,GAAG,aAAa,QAAQ,GAAG,aAAa,CAAC;AAErD,QAAM,OAAM,QAAG,cAAc,gBAAjB,YAAgC;AAE5C,QAAM,WAAW,IAAI,IAAI,eAAe,CAAC,YAAY;AACnD,QAAI,KAAC,sBAAQ,OAAO,KAAK,CAAC,QAAQ;AAAQ;AAE1C,UAAM,CAAC,KAAK,IAAI;AAChB,QAAI;AACJ,QAAI;AAEJ,QAAI,mBAAmB,OAAO;AAC5B,YAAM,kBAAkB,MAAM;AAC9B,YAAM,iBAAa,sBAAQ,eAAe,IACtC,gBAAgB,CAAC,IACjB;AAEJ,cAAQ,WAAW;AACnB,eAAS,WAAW;AAAA,IACtB,OAAO;AACL,cAAQ,GAAG;AACX,eAAS,GAAG;AAAA,IACd;AAEA,OAAG,EAAE,OAAO,OAAO,CAAC;AAAA,EACtB,CAAC;AAED,WAAS,QAAQ,IAAI,EAAE,KAAK,aAAa,CAAC;AAE1C,SAAO,MAAM,SAAS,UAAU,EAAE;AACpC;AAEA,IAAM,gBAAgB,CAAC,IAAwB,OAAmB;AAlDlE;AAmDE,MAAI,CAAC,MAAM,CAAC,GAAG;AAAe;AAE9B,QAAM,OAAM,cAAG,kBAAH,mBAAkB,gBAAlB,YAAiC;AAE7C,QAAM,WAAW,IAAI,IAAI,iBAAiB,MAAM;AAC9C,OAAG;AAAA,EACL,CAAC;AAED,WAAS,QAAQ,GAAG,eAAe,EAAE,WAAW,KAAK,CAAC;AAEtD,SAAO,MAAM;AACX,aAAS,WAAW;AAAA,EACtB;AACF;AAEO,IAAM,WAAW,CAA+B;AAAA,EACrD;AAAA,EACA,kBAAkB;AACpB,MAGM;AACJ,QAAM,CAAC,OAAO,QAAQ,QAAI,uBAAiB,CAAC,CAAC;AAC7C,QAAM,CAAC,OAAO,QAAQ,QAAI,uBAAS,CAAC;AAEpC,wCAAoB,MAAM;AACxB,UAAM,WAAW,SAAS;AAE1B,UAAM,WAAW,SAAS;AAAA,MAAI,CAAC,SAAS,UACtC,iBAAiB,SAAS,CAAC,SAAS;AAClC,iBAAS,CAACA,WAAU;AAClB,iBAAO;AAAA,YACL,GAAGA,OAAM,MAAM,GAAG,KAAK;AAAA,YACvB;AAAA,YACA,GAAGA,OAAM,MAAM,QAAQ,CAAC;AAAA,UAC1B;AAAA,QACF,CAAC;AAAA,MACH,CAAC;AAAA,IACH;AAEA,QAAI,iBAAiB;AACnB,YAAM,YAAY,SAAS,CAAC;AAE5B,eAAS;AAAA,QACP,cAAc,WAAW,MAAM;AAC7B,mBAAS,CAACC,WAAUA,SAAQ,CAAC;AAAA,QAC/B,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO,MAAM;AACX,eAAS,QAAQ,CAAC,YAAY;AAC5B;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF,GAAG,CAAC,KAAK,CAAC;AAEV,SAAO;AACT;AAEO,IAAM,UAAU,CACrB,YACG;AACH,QAAM,CAAC,IAAI,IAAI,SAAS;AAAA,IACtB,iBAAiB;AAAA,IAEjB,UAAU,MAAM;AACd,YAAM,WAAO,0BAAY,OAAO,IAAI,QAAQ,UAAU;AAEtD,aAAO,CAAC,IAAI;AAAA,IACd;AAAA,EACF,CAAC;AAED,SAAO;AACT;","names":["sizes","count"]}